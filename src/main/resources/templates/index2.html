<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventUp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/CSS/main.css}">
    <style>
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; height: 4.5em; }
        .hover-scale:hover { transform: scale(1.02); transition: 0.2s; }
    </style>
</head>
<body class="bg-light">

<div th:replace="~{Layout/navbar :: navbar-principal}"></div>

<header class="hero-section text-white text-center py-5 mb-5"
        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-top: -1px;">
    <div class="container py-5">
        <h1 class="display-4 fw-bold mb-3">Nunca mais vá sozinho!</h1>
        <p class="lead mb-4 opacity-75">Encontre eventos incríveis e conecte-se com quem também vai.</p>

        <button th:if="${session.usuarioLogado == null}"
                class="btn btn-light text-primary btn-lg rounded-pill fw-bold px-5 mb-4 shadow-sm hover-scale"
                data-bs-toggle="modal" data-bs-target="#modalCadastro">
            <i class="bi bi-person-plus-fill me-2"></i> Criar minha conta grátis
        </button>

        <div th:if="${session.usuarioLogado == null}" class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <form action="/" method="get" class="position-relative">
                    <input type="text" name="busca" class="form-control form-control-lg rounded-pill ps-4 pe-5 border-0 shadow-sm" placeholder="Buscar show, teatro..." th:value="${param.busca}">
                    <button type="submit" class="btn btn-primary rounded-pill position-absolute top-0 end-0 m-1 px-4 fw-bold">Buscar</button>
                </form>
            </div>
        </div>
    </div>
</header>

<div class="container mb-5">
    <div class="d-flex gap-2 overflow-auto pb-2 justify-content-lg-center">
        <a href="/" class="btn rounded-pill fw-bold px-4" th:classappend="${categoriaSelecionada == null} ? 'btn-dark' : 'btn-light border'">Todos</a>
        <a th:each="cat : ${categorias}" th:href="@{/(categoria=${cat.nomeCategoria})}"
           class="btn rounded-pill fw-bold px-4" th:classappend="${categoriaSelecionada == cat.nomeCategoria} ? 'btn-dark' : 'btn-light border'"
           th:text="${cat.nomeCategoria}"></a>
    </div>
</div>

<div class="container mb-5">
    <h3 class="fw-bold text-secondary mb-4">Próximos Eventos</h3>

    <div th:if="${#lists.isEmpty(eventos)}" class="text-center py-5">
        <p class="text-muted fs-5">Nenhum evento encontrado.</p>
        <a href="/" class="btn btn-outline-primary mt-2">Limpar filtros</a>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        <div class="col" th:each="ev : ${eventos}">
            <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden hover-scale">

                <div class="position-relative">
                    <img th:src="${ev.urlImagemDestaque != null && !ev.urlImagemDestaque.isEmpty() ? ev.urlImagemDestaque : 'https://placehold.co/600x400/purple/white?text=Evento'}"
                         class="card-img-top" style="height: 200px; object-fit: cover;">

                    <div th:if="${ev.dataHoraInicio != null}" class="position-absolute top-0 start-0 m-3 bg-danger text-white rounded p-2 text-center shadow-sm lh-1">
                        <span class="d-block fw-bold small" th:text="${#temporals.format(ev.dataHoraInicio, 'dd')}">01</span>
                        <span class="d-block small text-uppercase" style="font-size: 0.7rem;" th:text="${#temporals.format(ev.dataHoraInicio, 'MMM')}">DEZ</span>
                    </div>
                    <span class="position-absolute top-0 end-0 m-3 badge bg-light text-dark shadow-sm rounded-pill"
                          th:text="${ev.categoria?.nomeCategoria ?: 'Geral'}"></span>
                </div>

                <div class="card-body p-4">
                    <h5 class="card-title fw-bold mb-3" th:text="${ev.nomeEvento}">Nome</h5>
                    <p class="card-text text-secondary small mb-4 line-clamp-3" th:text="${ev.descricaoDetalhada}"></p>

                    <div class="d-flex justify-content-between align-items-center mt-auto">
                        <div class="d-flex align-items-center small fw-bold text-secondary">
                            <i class="bi bi-people-fill me-2"></i>
                            <span th:id="'contador-' + ${ev.id}" class="small fw-bold text-secondary">+15 vão</span>
                        </div>
                        <span class="badge rounded-pill px-3 py-2"
                              th:classappend="${ev.gratuito} ? 'bg-success bg-opacity-10 text-success' : 'bg-primary bg-opacity-10 text-primary'"
                              th:text="${ev.gratuito} ? 'Gratuito' : 'R$ ' + ${ev.valorIngresso}">
                            </span>
                    </div>
                </div>

                <div class="card-footer bg-white border-0 pb-4 pt-0 d-flex gap-2">
                    <button type="button" class="btn text-white w-100 rounded-pill fw-bold shadow-sm"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;"
                            th:onclick="'registrarInteresse(' + ${ev.id} + ')'">
                        Quero ir!
                    </button>

                    <button type="button" class="btn btn-outline-secondary w-100 rounded-pill fw-bold"
                            onclick="abrirDetalhes(this)"
                            th:data-titulo="${ev.nomeEvento}"
                            th:data-img="${ev.urlImagemDestaque}"
                            th:data-cat="${ev.categoria?.nomeCategoria}"
                            th:data-data="${ev.dataHoraInicio != null ? #temporals.format(ev.dataHoraInicio, 'dd/MM/yyyy') : ''}"
                            th:data-hora="${ev.dataHoraInicio != null ? #temporals.format(ev.dataHoraInicio, 'HH:mm') : ''}"
                            th:data-local="${ev.evento_online == true ? 'Evento Online' : ev.local_evento}"
                            th:data-valor="${ev.gratuito ? 'Gratuito' : 'R$ ' + ev.valorIngresso}"
                            th:data-desc="${ev.descricaoDetalhada}"
                            th:data-criador="${ev.usuarioCriador?.nome ?: 'EventUp'}">
                        Detalhes
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

<div th:replace="~{Layout/footer :: rodape-padrao}"></div>

<div th:replace="~{Usuario/criar_cadastro-modal :: modal-cadastro}"></div>
<div th:replace="~{Usuario/login-modal :: modal-login}"></div>
<div th:replace="~{Evento/criar_evento-modal :: modal-evento}"></div>
<div th:replace="~{Usuario/meus-dados-modal :: modal-meus-dados}"></div>
<div th:replace="~{Evento/detalhes-evento-modal :: modal-detalhes}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/JavaScript/app.js}"></script>

<script th:if="${erro}">
    document.addEventListener("DOMContentLoaded", function() {
        var loginModal = new bootstrap.Modal(document.getElementById('modalLogin'));
        loginModal.show();
    });
</script>

</body>
</html>